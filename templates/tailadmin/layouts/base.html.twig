<!doctype html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <meta
        name="viewport"
        content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"
    />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>{% block page_title %}{{ pageTitle|default('TailAdmin') }}{% endblock %}</title>
    <link rel="icon" href="{{ asset('tailadmin/favicon.ico') }}">
    <link href="{{ asset('tailadmin/style.css') }}" rel="stylesheet">
    <link href="{{ asset('styles/theme-colors.css') }}" rel="stylesheet">
    
    {# Firebase SDK - Version plus récente pour éviter les bugs #}
    <script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-messaging-compat.js"></script>
    
    {# Protection contre les erreurs Firebase #}
    <script>
        // Gestionnaire d'erreur global pour Firebase
        window.addEventListener('error', function(event) {
            if (event.error && event.error.message && event.error.message.includes('insert is not a function')) {
                console.warn('⚠️ Erreur Firebase détectée (e.insert is not a function) - Ignorée pour éviter de casser l\'application');
                event.preventDefault(); // Empêcher l'erreur de remonter
                return false;
            }
        }, true);
        
        // Gestionnaire pour les erreurs non capturées
        window.addEventListener('unhandledrejection', function(event) {
            if (event.reason && event.reason.message && event.reason.message.includes('insert is not a function')) {
                console.warn('⚠️ Erreur Firebase Promise rejetée (e.insert is not a function) - Ignorée');
                event.preventDefault();
            }
        });
    </script>
    
    {% block stylesheets %}{% endblock %}
</head>
<body
    x-data="{ page: '{{ pageName|default('blank') }}', 'loaded': true, 'darkMode': false, 'stickyMenu': false, 'sidebarToggle': false, 'scrollTop': false }"
    x-init="
        darkMode = JSON.parse(localStorage.getItem('darkMode'));
        $watch('darkMode', value => localStorage.setItem('darkMode', JSON.stringify(value)))"
    :class="{'dark bg-gray-900': darkMode === true}"
>
    {% include 'tailadmin/components/preloader.html.twig' %}

    <!-- ===== Page Wrapper Start ===== -->
    <div class="flex h-screen overflow-hidden">
        {% if app.user %}
            {% include 'tailadmin/components/sidebar.html.twig' %}
        {% endif %}

        <!-- ===== Content Area Start ===== -->
        <div class="relative flex flex-col flex-1 overflow-x-hidden overflow-y-auto">
            {% if app.user %}
                {% include 'tailadmin/components/overlay.html.twig' %}
                {% include 'tailadmin/components/header.html.twig' %}
            {% endif %}

            <!-- ===== Main Content Start ===== -->
            <main>
                {% block content %}{% endblock %}
            </main>
            <!-- ===== Main Content End ===== -->
        </div>
        <!-- ===== Content Area End ===== -->
    </div>
    <!-- ===== Page Wrapper End ===== -->

    {% include 'tailadmin/components/alert.html.twig' %}
    <script defer src="{{ asset('tailadmin/bundle.js') }}"></script>
</body>
</html>

